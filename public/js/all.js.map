{"version":3,"sources":["home.js","ngApps.js","postController.js","posts.service.js","profileController.js","directives/directives.js","directives/translate.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AClBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"all.js","sourcesContent":["function getFeedCate(slug){\r\n    $.get( \"/getFeed/\", { slug: slug } )\r\n        .done(function( data ) {\r\n            $('#homeFeed').html(data);\r\n        });\r\n}\r\n\r\nfunction ipLogger()\r\n{\r\n    $.getJSON('http://ipinfo.io', function(data){\r\n        return data;\r\n    })\r\n}\r\n\r\n$('a.card-link').click(function(e)\r\n{\r\n    // Cancel the default action\r\n    e.preventDefault();\r\n});","//Angular config and modules\r\n\r\nvar app = angular.module('App', ['ngMaterial','flow','angularMoment','firebase',\r\n                                 'toastr',\r\n                                 'angular.filter',\r\n                                 'ngCookies','ngSanitize',\r\n                                 'pascalprecht.translate'])\r\n\r\n.constant('FirebaseUrl', 'https://qanya.firebaseio.com/')\r\n\r\n\r\n\r\n.config(['$translateProvider', function ($translateProvider) {\r\n    // Enable escaping of HTML\r\n    //$translateProvider.useSanitizeValueStrategy('sanitize');\r\n}])\r\n\r\n\r\n.config([\"$mdThemingProvider\", function ($mdThemingProvider) {\r\n    $mdThemingProvider.definePalette('slack', {\r\n        '50': '5DB09D',\r\n        '100': 'ffcdd2',\r\n        '200': 'ef9a9a',\r\n        '300': 'e57373',\r\n        '400': '5DB09D',\r\n        '500': '684666', // primary colour\r\n        '600': 'e53935',\r\n        '700': 'd32f2f',\r\n        '800': 'c62828',\r\n        '900': 'b71c1c',\r\n        'A100': 'ff8a80',\r\n        'A200': 'ff5252',\r\n        'A400': 'ff1744',\r\n        'A700': 'd50000',\r\n        'contrastDefaultColor': 'light', // whether, by default, text (contrast)\r\n        // on this palette should be dark or light\r\n        'contrastDarkColors': ['50', '100', // hues which contrast should be 'dark' by default\r\n            '200', '300', '400', 'A100'],\r\n        'contrastLightColors': undefined // could also specify this if default was 'dark'\r\n    })\r\n    $mdThemingProvider.theme('default')\r\n        .primaryPalette('slack')\r\n}])\r\n\r\n\r\n//For removing that <p> from topic header\r\n.filter('htmlToPlaintext', function() {\r\n        return function(text) {\r\n            return  text ? String(text).replace(/<[^>]+>/gm, '') : '';\r\n        };\r\n    }\r\n)\r\n\r\n//Limit the number of length\r\n//http://jsfiddle.net/tuyyx/\r\n.filter('truncate', function () {\r\n    return function (text, length, end) {\r\n        if (isNaN(length))\r\n            length = 10;\r\n\r\n        if (end === undefined)\r\n            end = \"...\";\r\n\r\n        if (text.length <= length || text.length - end.length <= length) {\r\n            return text;\r\n        }\r\n        else {\r\n            return String(text).substring(0, length-end.length) + end;\r\n        }\r\n\r\n    };\r\n});","angular.module('App')\r\n    .controller('PostCtrl',function($http,$scope, $sce, $mdDialog, $mdMedia,$firebaseObject,$firebaseArray,Topics,toastr){\r\n\r\n        var postCtrl = this;\r\n\r\n\r\n        postCtrl.topics = Topics;\r\n\r\n        postCtrl.displayname ={\r\n            'text' :'',\r\n            'saveBtn':  false,\r\n            'alert':    false\r\n        }\r\n\r\n        postCtrl.topicTags      =   [];\r\n        postCtrl.postFeedFollow =   'Follow';\r\n        postCtrl.postFollow     =   'Follow';\r\n        postCtrl.topicReply     =   '';\r\n\r\n        //Review criteria\r\n        postCtrl.criteria       =   false;\r\n        postCtrl.criteriaReply  =   null;\r\n\r\n        postCtrl.reviewCriteria =   false;\r\n        postCtrl.critReplyData  =   null;\r\n        postCtrl.userRateReview =   null;\r\n\r\n        //Material Open Menu\r\n        postCtrl.openMenu = function($mdOpenMenu, ev) {\r\n            originatorEv = ev;\r\n            $mdOpenMenu(ev);\r\n        };\r\n\r\n        //--- REVIEW ---\r\n        //Get Review from the post\r\n        postCtrl.getReview = function(topic_uuid) {\r\n            $http.post('/retrieve-review/', {data: topic_uuid})\r\n                .then(function (response) {\r\n                    var key = 'responseReview' + topic_uuid;\r\n                    postCtrl[key] = response.data;\r\n                })\r\n        }\r\n\r\n\r\n        //Calculate the average score\r\n        postCtrl.avgScore = function(scores_arr)\r\n        {\r\n            var ttl_score   =   0;\r\n            var ttl_length  =   0;\r\n\r\n            angular.forEach(scores_arr, function(value, key){\r\n                ttl_score = ttl_score+parseInt(value.scores);\r\n                ttl_length++;\r\n            });\r\n            return ttl_score/ttl_length;\r\n        }\r\n\r\n\r\n        postCtrl.getReviewForm = function(topic_uuid){\r\n            $http.post('/reviewForm/', {data: topic_uuid})\r\n                .then(function (response) {\r\n                    var key = 'responseReview' + topic_uuid;\r\n                    postCtrl[key] = response.data;\r\n                })\r\n        }\r\n\r\n        //--- END REVIEW ---\r\n\r\n\r\n        //Display pop up login\r\n        postCtrl.showLogin = function(ev) {\r\n        var useFullScreen = ($mdMedia('sm') || $mdMedia('xs'))  && $scope.customFullscreen;\r\n            $mdDialog.show({              \r\n              templateUrl: 'http://192.168.0.100:8888/login',\r\n              parent: angular.element(document.body),\r\n              targetEvent: ev,\r\n              clickOutsideToClose:true,\r\n              fullscreen: useFullScreen\r\n            })\r\n        }\r\n\r\n\r\n\r\n        postCtrl.feedFollowStatus = function(slug)\r\n        {\r\n            $http.post('/feedFollowStatus/', {data: slug})\r\n                .then(function(response){\r\n                    if(response.data == 0)\r\n                    {\r\n                        postCtrl.postFeedFollow = 'follow';\r\n                    }else{\r\n                        postCtrl.postFeedFollow = 'following';\r\n                    }\r\n                });\r\n        }\r\n\r\n\r\n\r\n        //Tags that user follow\r\n        postCtrl.userTagList = function(user_uuid)\r\n        {\r\n            var ref = postCtrl.topics.userUrl(user_uuid).child('follow_tag');\r\n            ref.once(\"value\", function(snapshot) {\r\n                postCtrl.userTags = snapshot.val();\r\n            })\r\n        }\r\n\r\n        //Check the current status on this tag for this user\r\n        postCtrl.followTagStatus = function(user_uuid,tag)\r\n        {\r\n            var followTag = postCtrl.topics.userUrl(user_uuid).child('follow_tag/'+tag);\r\n            followTag.once(\"value\", function(snapshot) {\r\n                if(snapshot.exists()) {\r\n                    postCtrl.tagFollowStatus = 'following';\r\n                }else{\r\n                    postCtrl.tagFollowStatus = 'follow';\r\n                }\r\n            })\r\n        }\r\n\r\n\r\n        //Follow Tag\r\n        postCtrl.followTag = function(user_uuid,tag)\r\n        {\r\n            var followTag = postCtrl.topics.userUrl(user_uuid).child('follow_tag/'+tag);\r\n            followTag.once(\"value\", function(snapshot) {\r\n                if(snapshot.exists())\r\n                {\r\n                    postCtrl.topics.userUrl(user_uuid).child('follow_tag/' + tag).remove();\r\n                    postCtrl.tagFollowStatus = 'follow';\r\n                }\r\n                else\r\n                {\r\n                    //Add this tag to user's follow tag list\r\n                    postCtrl.topics.userUrl(user_uuid).child('follow_tag/' + tag).set(moment().format());\r\n                    postCtrl.tagFollowStatus = 'following';\r\n                }\r\n            })\r\n        }\r\n\r\n\r\n        //Follow categories\r\n        postCtrl.followCate = function(slug){\r\n\r\n            $http.post('/follow-cate/', {data: slug})\r\n                .then(function(response){\r\n                    console.log(response)\r\n                    if(response.data== 0)\r\n                    {\r\n                        postCtrl.postFeedFollow ='follow';\r\n                    }\r\n                    else\r\n                    {\r\n                        postCtrl.postFeedFollow ='following';\r\n                    }\r\n                });\r\n        }\r\n\r\n\r\n        //Follower user\r\n        //@Params uuid - author ID\r\n        postCtrl.followUser = function(user_uuid,uuid)\r\n        {\r\n            var followStatus = postCtrl.topics.userUrl(user_uuid).child('follow_user/'+uuid);\r\n            followStatus.once(\"value\", function(snapshot) {\r\n                if(snapshot.exists() == false)\r\n                {\r\n                    postCtrl.topics.userUrl(user_uuid).child('follow_user/'+uuid).set(moment().format());\r\n                    postCtrl.postFollow = 'following'\r\n\r\n                    //Update stat for user being follow\r\n                    var followStatus = postCtrl.topics.userUrl(uuid).child('stat/follower/')\r\n                    followStatus.transaction(function (current_value) {\r\n                        return (current_value || 0) + 1;\r\n                    })\r\n                }\r\n                else\r\n                {\r\n                    postCtrl.topics.userUrl(user_uuid).child('follow_user/'+uuid).remove();\r\n                    postCtrl.postFollow = 'follow'\r\n\r\n                    var followStatus = postCtrl.topics.userUrl(uuid).child('stat/follower/')\r\n                    followStatus.transaction(function (current_value) {\r\n                        return negCurrentValueCheck(current_value);\r\n                    })\r\n                }\r\n            })\r\n        }\r\n\r\n\r\n        //Is currently following user\r\n        //@Params uuid - author ID\r\n        postCtrl.isFollow = function(user_uuid,uuid)\r\n        {\r\n            var followStatus = postCtrl.topics.userUrl(user_uuid).child('follow_user/'+uuid);\r\n            followStatus.once(\"value\", function(snapshot) {\r\n                if(snapshot.exists() == false)\r\n                {\r\n                    postCtrl.postFollow = 'follow'\r\n                }\r\n                else\r\n                {\r\n                    postCtrl.postFollow = 'following'\r\n                }\r\n            })\r\n        }\r\n\r\n\r\n        postCtrl.getFeedCate = function(slug,catename){\r\n            postCtrl.slug = slug;\r\n            postCtrl.feedName =  catename;\r\n            $http.post('/getFeed/', {slug: slug})\r\n                .then(function(response){\r\n                    postCtrl.feedHtml = response.data;\r\n                    $('#homeFeed').html(response.data);\r\n                    //postCtrl.FeedHtml = $sce.trustAsHtml(response.data);\r\n                });\r\n        }\r\n\r\n\r\n        postCtrl.checkDisplayname = function(){\r\n\r\n            $http.post('/check-name', {name: postCtrl.displayname.text})\r\n                .then(function(response){\r\n                if(response.data == \"0\"){\r\n                    postCtrl.displayname.saveBtn = true;\r\n                    postCtrl.displayname.alert   = false;\r\n                }else{\r\n                    postCtrl.displayname.saveBtn = false;\r\n                    postCtrl.displayname.alert   = true;\r\n                }\r\n            });\r\n        }\r\n\r\n\r\n\r\n        //Reply in the post\r\n        postCtrl.postReply = function(uuid,topics_uid,sender)\r\n        {\r\n            console.log(postCtrl.responseReview+uuid);\r\n\r\n          /*  $http.post('/replyTopic', {uuid: uuid,\r\n                                       topics_uid: topics_uid,\r\n                                       data: $('#topicReplyContainer').html() })\r\n                .then(function(response){\r\n                    $http.get(\"http://ipinfo.io\")\r\n                        .then(function(response){\r\n                        var geo_data = response\r\n                        $http.post('/ip-logger', {  uuid: uuid,\r\n                            topics_uid: topics_uid,\r\n                            action: 'reply',\r\n                            geoResponse: geo_data\r\n                        })\r\n                    })\r\n                    var commentCounter = postCtrl.topics.ref.child('topic/'+uuid+'/comments')\r\n                    commentCounter.transaction(function (current_value) {\r\n                        return (current_value || 0) + 1;\r\n                    })\r\n                })*/\r\n        }\r\n\r\n\r\n        //Get all messages for reply in reply\r\n        postCtrl.replyInReplyList = function(reply_id)\r\n        {\r\n            var key = '#replyInReply_'+reply_id;\r\n            $http.post('/replyInReplyList', { reply_id: reply_id })\r\n                .then(function(response){\r\n                    $(key).html(response.data);\r\n                })\r\n        }\r\n\r\n        //Submit reply in reply\r\n        postCtrl.submitReplyInReply = function(reply_id,topic_uuid,user_uuid)\r\n        {\r\n            var key = '#replyInReplyContainer_'+reply_id;\r\n            $http.post('/replyInReply', {   uuid: user_uuid,\r\n                                            topics_uuid: topic_uuid,\r\n                                            reply_id: reply_id,\r\n                                            data: $(key).html() })\r\n                .then(function(response){\r\n                    postCtrl.replyInReplyList(reply_id);\r\n                })\r\n        }\r\n\r\n        //Upvote user in reply in reply\r\n        postCtrl.replyInReplyUpvote = function(reply_id,topic_uuid,recipient,user_uuid)\r\n        {\r\n            postCtrl.replyInReplyDownvoteReset(reply_id,user_uuid);\r\n\r\n            var upvoteReplyInReply = postCtrl.topics.ref.child('rir/'+reply_id+'/upvote');\r\n\r\n            upvoteReplyInReply.once(\"value\", function(snapshot) {\r\n                if(snapshot.exists() == false)\r\n                {\r\n                    postCtrl.topics.ref.child('rir/'+reply_id+'/upvote/'+'/'+user_uuid)\r\n                        .set({'recipient': recipient ,'created_at':moment().format()});\r\n\r\n                    var ttlUpvote = postCtrl.topics.ref.child('rir/'+reply_id+'/upvote_total')\r\n                    ttlUpvote.transaction(function (current_value) {\r\n                        return (current_value || 0) + 1;\r\n                    });\r\n\r\n\r\n                    var recipientRef = postCtrl.topics.userUrl(recipient).child('stat/upvote');\r\n                    recipientRef.transaction(function (current_value) {\r\n                        return (current_value || 0) + 1;\r\n                    });\r\n\r\n                    var recipientRef = postCtrl.topics.userUrl(recipient).child('stat/downvote');\r\n                    recipientRef.transaction(function (current_value) {\r\n                        return negCurrentValueCheck(current_value);\r\n                    });\r\n                }\r\n                else{\r\n                    postCtrl.replyInReplyUpvoteReset(reply_id,user_uuid);\r\n\r\n                    var recipientRef = postCtrl.topics.userUrl(recipient).child('stat/upvote');\r\n                    recipientRef.transaction(function (current_value) {\r\n                        return negCurrentValueCheck(current_value);\r\n                    });\r\n                }\r\n            })\r\n        }\r\n\r\n        //Upvote user in reply in reply\r\n        postCtrl.replyInReplyDownvote = function(reply_id,topic_uuid,recipient,user_uuid)\r\n        {\r\n            postCtrl.replyInReplyUpvoteReset(reply_id,user_uuid);\r\n\r\n            var upvoteReplyInReply = postCtrl.topics.ref.child('rir/'+reply_id+'/downvote');\r\n\r\n            upvoteReplyInReply.once(\"value\", function(snapshot) {\r\n                if(snapshot.exists() == false)\r\n                {\r\n                    postCtrl.topics.ref.child('rir/'+reply_id+'/downvote/'+'/'+user_uuid)\r\n                        .set({'recipient': recipient ,'created_at':moment().format()});\r\n\r\n                    var ttlUpvote = postCtrl.topics.ref.child('rir/'+reply_id+'/downvote_total')\r\n                    ttlUpvote.transaction(function (current_value) {\r\n                        return (current_value || 0) + 1;\r\n                    });\r\n\r\n\r\n                    var recipientRef = postCtrl.topics.userUrl(recipient).child('stat/downvote');\r\n                    recipientRef.transaction(function (current_value) {\r\n                        return (current_value || 0) + 1;\r\n                    });\r\n\r\n                    var recipientRef = postCtrl.topics.userUrl(recipient).child('stat/upvote');\r\n                    recipientRef.transaction(function (current_value) {\r\n                        return negCurrentValueCheck(current_value);\r\n                    });\r\n                }\r\n                else{\r\n\r\n                    postCtrl.replyInReplyDownvoteReset(reply_id,user_uuid);\r\n\r\n                    var recipientRef = postCtrl.topics.userUrl(recipient).child('stat/downvote');\r\n                    recipientRef.transaction(function (current_value) {\r\n                        return negCurrentValueCheck(current_value);\r\n                    });\r\n                }\r\n            })\r\n        }\r\n\r\n\r\n        //Reply In Reply Upvote Tally\r\n        postCtrl.replyInReplyUpvoteTally = function(reply_id)\r\n        {\r\n            var ttlUpvote = postCtrl.topics.ref.child('rir/'+reply_id+'/upvote_total')\r\n            ttlUpvote.on(\"value\",function(snapshot){\r\n                var key = 'reply_upvote_'+reply_id;\r\n                postCtrl[key]  = snapshot.val();\r\n            })\r\n        }\r\n\r\n        postCtrl.replyInReplyDownvoteTally = function(reply_id)\r\n        {\r\n            var ttlUpvote = postCtrl.topics.ref.child('rir/'+reply_id+'/downvote_total')\r\n            ttlUpvote.on(\"value\",function(snapshot){\r\n                var key = 'reply_downvote_'+reply_id;\r\n                postCtrl[key]  = snapshot.val();\r\n            })\r\n        }\r\n\r\n        //Reset upvote to zero\r\n        postCtrl.replyInReplyUpvoteReset =function(reply_id,user_uuid)\r\n        {\r\n            postCtrl.topics.ref.child('rir/'+reply_id+'/upvote/'+user_uuid).remove();\r\n\r\n            var ttlUpvote = postCtrl.topics.ref.child('rir/'+reply_id+'/upvote_total')\r\n            ttlUpvote.transaction(function (current_value) {\r\n                return negCurrentValueCheck(current_value);\r\n            });\r\n\r\n        }\r\n\r\n        //Reset downvote to zero\r\n        postCtrl.replyInReplyDownvoteReset =function(reply_id,user_uuid)\r\n        {\r\n            postCtrl.topics.ref.child('rir/'+reply_id+'/downvote/'+user_uuid).remove();\r\n\r\n            var ttlUpvote = postCtrl.topics.ref.child('rir/'+reply_id+'/downvote_total')\r\n            ttlUpvote.transaction(function (current_value) {\r\n                return negCurrentValueCheck(current_value);\r\n            });\r\n        }\r\n\r\n        postCtrl.showConfirmDelete = function(ev,topic_uuid,user_uuid) {\r\n            // Appending dialog to document.body to cover sidenav in docs app\r\n            var confirm = $mdDialog.confirm()\r\n                .title('Delete this?')\r\n                .textContent('If you remove this, you will not be able to get it back')\r\n                .ariaLabel('Delete')\r\n                .targetEvent(ev)\r\n                .ok('Please do it!')\r\n                .cancel('nah...');\r\n            $mdDialog.show(confirm).then(function() {\r\n                var data = {\r\n                    topic_uuid: topic_uuid,\r\n                    user_uuid:  user_uuid\r\n                }\r\n                $http.post('/removeTopic', {data: data })\r\n                    .then(function(response){\r\n                        window.location = '/';\r\n                    })\r\n                $scope.status = 'You decided to get rid of your debt.';\r\n\r\n            }, function() {\r\n                $scope.status = 'You decided to keep your debt.';\r\n            });\r\n        };\r\n\r\n\r\n\r\n        //For Review\r\n        //Add new item\r\n        postCtrl.addNewChoice = function() {\r\n            var newItemNo = postCtrl.reviewCriteria.length+1;\r\n            postCtrl.reviewCriteria.push({'id':'criteria'+newItemNo});\r\n        };\r\n\r\n        //Remove added item\r\n        postCtrl.removeChoice = function() {\r\n            var lastItem = postCtrl.reviewCriteria.length-1;\r\n            postCtrl.reviewCriteria.splice(lastItem);\r\n        };\r\n\r\n\r\n        //Post topic\r\n        postCtrl.postTopic = function()\r\n        {\r\n            var imgIds = new Array();\r\n\r\n            //Search for images in the content\r\n            $(\"div#contentBody img\").each(function(){\r\n                imgIds.push($(this).attr('src'));\r\n            });\r\n\r\n\r\n            var data = { title:         postCtrl.title,\r\n                         type:          postCtrl.postTypes,\r\n                         categories:    postCtrl.categories,\r\n                         tags:          postCtrl.topicTags,\r\n                         body:          $('#contentBody').html(),\r\n                         text:          $('#contentBody').text(),\r\n                         images:        imgIds,\r\n                         reviews:       postCtrl.reviewCriteria\r\n                        };\r\n            $.post( \"/api/postTopic/\", { data: data} )\r\n                .done(function( response ) {\r\n                    console.log(response.data);\r\n                    $http.get(\"http://ipinfo.io\")\r\n                        .then(function(response){\r\n                            var geo_data = response\r\n                            $http.post('/ip-logger', {  uuid: uuid,\r\n                                topics_uid: topics_uid,\r\n                                action: 'topic',\r\n                                geoResponse: geo_data\r\n                            })\r\n                        })\r\n                    url = '/'+response.author+'/'+response.slug;\r\n                    window.location = url;\r\n                })\r\n\r\n        }\r\n\r\n        //Preview images\r\n        postCtrl.imageStrings = [];\r\n        postCtrl.processFiles = function(files,container){\r\n            angular.forEach(files, function(flowFile, i){\r\n                var fileReader = new FileReader();\r\n                fileReader.onload = function (event) {\r\n                    var uri = event.target.result;\r\n                    toastr.info('uploading...!');\r\n                    postCtrl.imageStrings[i] = uri;\r\n                    $.post( \"/api/previewImage/\", { data: uri} )\r\n                        .done(function( response ) {\r\n                            toastr.success('Done!',{\r\n                                iconClass: 'toast-success'\r\n                            });\r\n                            $(container).append('<img src=\\\"'+response+'\\\" class=\\\"img-fluid\\\">');\r\n                        })\r\n                };\r\n                fileReader.readAsDataURL(flowFile.file);\r\n            });\r\n        };\r\n\r\n\r\n        //Update topic content\r\n        postCtrl.updateTopicContent = function(topic_uuid,topic_id)\r\n        {\r\n            var imgIds = new Array();\r\n            //Search for images in the content\r\n            $(\"div#topicContent img\").each(function(){\r\n                imgIds.push($(this).attr('src'));\r\n            });\r\n\r\n            var data = {\r\n                topic_uuid: topic_uuid,\r\n                topic_id:   topic_id,\r\n                body:       $('#topicContent').html(),\r\n                text:       $('#topicContent').text(),\r\n                images:     imgIds\r\n            }\r\n            $http.post('/api/updateTopicContent', {data: data })\r\n                .then(function(response){\r\n                    toastr.success('Save!',{\r\n                        iconClass: 'toast-success'\r\n                    });\r\n                })\r\n        }\r\n\r\n        //Login for material\r\n        postCtrl.showMdLogin = function(ev) {\r\n            var useFullScreen = ($mdMedia('sm') || $mdMedia('xs')) && $scope.customFullscreen;\r\n            $mdDialog.show({\r\n                //controller: 'AuthCtrl as authCtrl',\r\n                //templateUrl: 'templates/html/form-login',\r\n                parent: angular.element(document.body),\r\n                targetEvent: ev,\r\n                clickOutsideToClose: true,\r\n                fullscreen: useFullScreen\r\n            })\r\n        }\r\n\r\n        //Get the post images\r\n        postCtrl.getPostImage = function(uuid)\r\n        {\r\n            $http.post('/getPostImages', {uuid: uuid })\r\n                .then(function(response) {\r\n                    var key = 'previewImage_'+uuid;\r\n                    postCtrl[key] = response.data;\r\n                    /*$(key).html(response.data);\r\n                    postCtrl[key] = response.data;*/\r\n                })\r\n        }\r\n\r\n\r\n        //Count the number of bookmark per topic\r\n        postCtrl.bookMarkTally = function(topic_uuid)\r\n        {\r\n            var ref = postCtrl.topics.ref.child('topic/'+topic_uuid+'/bookmark')\r\n            ref.on(\"value\", function (snapshot) {\r\n                var key = 'bookmarks_'+topic_uuid;\r\n                postCtrl[key]  = snapshot.val();\r\n            });\r\n        }\r\n\r\n\r\n        postCtrl.userBookMarked = function(user_uuid,topic_uuid)\r\n        {\r\n            var key = 'user_bookmarked_'+topic_uuid;\r\n            var userBookmark = postCtrl.topics.userUrl(user_uuid).child('bookmark/'+topic_uuid);\r\n\r\n            userBookmark.once(\"value\", function(snapshot) {\r\n                if (snapshot.exists() == false) {\r\n                    postCtrl[key] = false;\r\n                }\r\n                else {\r\n                    postCtrl[key] = true;\r\n                }\r\n            })\r\n        }\r\n\r\n        postCtrl.bookMark = function(user_uuid,topic_uuid)\r\n        {\r\n            var userBookmark = postCtrl.topics.userUrl(user_uuid).child('bookmark/'+topic_uuid);\r\n            var key = 'user_bookmarked_'+topic_uuid;\r\n\r\n            userBookmark.once(\"value\", function(snapshot) {\r\n                if(snapshot.exists() == false)\r\n                {\r\n                    postCtrl.topics.userUrl(user_uuid).child('bookmark/'+topic_uuid).set(moment().format());\r\n\r\n                    var topicRef = postCtrl.topics.ref.child('topic/' + topic_uuid + '/bookmark')\r\n                    topicRef.transaction(function (current_value) {\r\n                        return (current_value || 0) + 1;\r\n                    });\r\n                    postCtrl[key]  = true;\r\n                }\r\n                else{\r\n                    postCtrl.topics.userUrl(user_uuid).child('bookmark/'+topic_uuid).remove();\r\n                    \r\n                    var topicRef = postCtrl.topics.ref.child('topic/' + topic_uuid + '/bookmark')\r\n                    topicRef.transaction(function (current_value) {\r\n                        return negCurrentValueCheck(current_value);\r\n                    });\r\n                    postCtrl[key]  = false;\r\n                }\r\n            })\r\n        }\r\n\r\n        postCtrl.commentsTally    =   function(topic_uuid)\r\n        {\r\n            var ref = postCtrl.topics.ref.child('topic/'+topic_uuid+'/comments')\r\n            ref.on(\"value\", function (snapshot) {\r\n                var key = 'comments_'+topic_uuid;\r\n                postCtrl[key]  = snapshot.val();\r\n            });\r\n        }\r\n\r\n\r\n        /*\r\n        *  Upvote Downvote topics fropm here\r\n        * */\r\n        postCtrl.upvoteTally    =   function(topic_uuid)\r\n        {\r\n            var ref = postCtrl.topics.ref.child('topic/'+topic_uuid+'/upvote')\r\n            ref.on(\"value\", function (snapshot) {\r\n                var key = 'upvote_'+topic_uuid;\r\n                postCtrl[key]  = snapshot.val();\r\n            });\r\n        }\r\n\r\n        postCtrl.dwnvoteTally    =   function(topic_uuid)\r\n        {\r\n            var ref = postCtrl.topics.ref.child('topic/'+topic_uuid+'/downvote')\r\n            ref.on(\"value\", function(snapshot) {\r\n                var the_string = 'dwnvote_'+topic_uuid;\r\n                postCtrl[the_string]  = snapshot.val();\r\n            });\r\n        }\r\n\r\n        postCtrl.dwnvote =function(topic_uuid,topic_uid)\r\n        {\r\n            postCtrl.upvoteReset(topic_uuid,topic_uid);\r\n            var btn = \"#dwnvote_btn_status_\"+topic_uuid;\r\n\r\n            //UserDownvote Value\r\n            var userUpvoteRef = postCtrl.topics.userUrl(topic_uid).child('downvote/'+topic_uuid);\r\n            userUpvoteRef.once(\"value\", function(snapshot) {\r\n\r\n                //Chck if user already voted\r\n                if (snapshot.exists() == false) {\r\n\r\n                    postCtrl.topics.userUrl(topic_uid).child('downvote/'+topic_uuid).set(moment().format());\r\n\r\n                    //Topic Upvote tally\r\n                    var topicRef = postCtrl.topics.ref.child('topic/'+topic_uuid+'/downvote')\r\n                    topicRef.transaction(function (current_value) {\r\n                        return (current_value || 0) + 1;\r\n                    });\r\n                }else{ //value already exist\r\n                    postCtrl.dwnvoteReset(topic_uuid,topic_uid);\r\n                }\r\n            })\r\n        }\r\n\r\n\r\n        //Reset upvote to zero\r\n        postCtrl.upvoteReset =function(topic_uuid,topic_uid)\r\n        {\r\n            var btn = \"#upvote_btn_status_\"+topic_uuid;\r\n            //Remove voted user\r\n            postCtrl.topics.userUrl(topic_uid).child('upvote/'+topic_uuid).remove();\r\n\r\n            //Decrement the tally\r\n            var topicRef = postCtrl.topics.ref.child('topic/'+topic_uuid+'/upvote')\r\n            topicRef.transaction(function (current_value) {\r\n                return negCurrentValueCheck(current_value);\r\n            });\r\n            \r\n        }\r\n\r\n        //Reset downvote to zero\r\n        postCtrl.dwnvoteReset =function(topic_uuid,topic_uid)\r\n        {\r\n            var btn = \"#dwnvote_btn_status_\"+topic_uuid;\r\n            //Remove voted user\r\n            postCtrl.topics.userUrl(topic_uid).child('downvote/'+topic_uuid).remove();\r\n\r\n            //Decrement the tally\r\n            var topicRef = postCtrl.topics.ref.child('topic/'+topic_uuid+'/downvote')\r\n            topicRef.transaction(function (current_value) {\r\n                return negCurrentValueCheck(current_value);\r\n            });\r\n        }\r\n\r\n\r\n        postCtrl.upvote =function(topic_uuid,topic_uid)\r\n        {\r\n            postCtrl.dwnvoteReset(topic_uuid,topic_uid);\r\n            var btn = \"#upvote_btn_status_\"+topic_uuid;\r\n            \r\n            //UserUpvote Value\r\n            var userUpvoteRef = postCtrl.topics.userUrl(topic_uid).child('upvote/'+topic_uuid);\r\n            userUpvoteRef.once(\"value\", function(snapshot) {\r\n\r\n                //Chck if user already voted\r\n                if (snapshot.exists() == false) {\r\n\r\n                    postCtrl.topics.userUrl(topic_uid).child('upvote/'+topic_uuid).set(moment().format());\r\n\r\n                    //Topic Upvote tally\r\n                    var topicRef = postCtrl.topics.ref.child('topic/'+topic_uuid+'/upvote')\r\n                    topicRef.transaction(function (current_value) {\r\n                        return (current_value || 0) + 1;\r\n                    });\r\n\r\n                    //Update stat for poster\r\n                    var followStatus = postCtrl.topics.userUrl(topic_uid).child('stat/upvote/')\r\n                    followStatus.transaction(function (current_value) {\r\n                        return (current_value || 0) + 1;\r\n                    })\r\n\r\n                }else{ //value already exist\r\n                    postCtrl.upvoteReset(topic_uuid,topic_uid);\r\n                    \r\n                    //Update stat for poster\r\n                    var followStatus = postCtrl.topics.userUrl(topic_uid).child('stat/upvote/')\r\n                    followStatus.transaction(function (current_value) {\r\n                        if(current_value < 0 || current_value == 0 )\r\n                        {\r\n                            return 0;\r\n                        }else{\r\n                            return current_value - 1;\r\n                        }\r\n                    })\r\n                }\r\n            })\r\n        }\r\n    })\r\n\r\nfunction negCurrentValueCheck(current_value)\r\n{\r\n    if(current_value < 0 || current_value == 0 || current_value == '' || current_value == null)\r\n    {\r\n        return 0;\r\n    }else {\r\n        return (current_value) - 1;\r\n    }\r\n}","angular.module('App')\r\n    // Topic list\r\n    .factory('Topics', function ($firebaseObject, $firebaseArray, FirebaseUrl) {\r\n        var ref = new Firebase(FirebaseUrl)\r\n        var topics = $firebaseObject(ref)\r\n        var topicsArr = $firebaseArray(ref)\r\n        var topicKey = '';\r\n\r\n        var Topics = {\r\n\r\n            // Reply listing\r\n            userUrl: function (user_uuid){\r\n                return ref.child('user/'+user_uuid)\r\n            },\r\n            replyList: function (topic_uuid) {\r\n                var data = ref.child(topic_uuid + '/replies');\r\n                console.log(data);\r\n                return $firebaseArray(data)\r\n            },\r\n            ref: ref\r\n        }\r\n        return Topics;\r\n\r\n    })\r\n","angular.module('App')\r\n    .controller('ProfileCtrl',function($http,$mdToast,$timeout, $mdSidenav, $log, $cookies, $translate,\r\n                                       toastr,Topics) {\r\n\r\n        var profileCtrl = this;\r\n\r\n        profileCtrl.topic = Topics;\r\n        profileCtrl.profileDescription = '';\r\n        profileCtrl.notificationList = '';\r\n        profileCtrl.unreadNotification = 0;\r\n        profileCtrl.userBookmark = 0;\r\n        profileCtrl.userPostedPhotos = '';\r\n        profileCtrl.user = null;\r\n        profileCtrl.userLang = 'Eng';\r\n\r\n\r\n\r\n\r\n        profileCtrl.toggleRight     = buildToggler('alertSideNav');\r\n        profileCtrl.toggleMobile    = buildToggler('mobile');\r\n        profileCtrl.isOpenRight = function () {\r\n            return $mdSidenav('alertSideNav').isOpen();\r\n        };\r\n\r\n\r\n\r\n        //User profile\r\n        profileCtrl.profile = function(authData){\r\n            profileCtrl.user = JSON.parse(authData);\r\n        }\r\n\r\n        //Change language\r\n        profileCtrl.toggleLang = function (langKey) {\r\n            $translate.use(langKey);\r\n            // Setting a cookie\r\n            $cookies.put('userLang', langKey);\r\n            profileCtrl.userLang = langKey;\r\n            //If user registered - update this in their preference\r\n            /*if(Auth.ref.getAuth()){\r\n                profileCtrl.users.userArrRef(Auth.ref.getAuth().uid).update({\"lang\":langKey})\r\n            }*/\r\n        }\r\n\r\n        //Checkk user selected language\r\n        if(!profileCtrl.profile.lang){\r\n            if($cookies.get('userLang')){\r\n                profileCtrl.toggleLang($cookies.get('userLang'));\r\n            }else{\r\n                profileCtrl.toggleLang('Eng');\r\n            }\r\n        }\r\n        else{\r\n            profileCtrl.toggleLang(profileCtrl.profile.lang);\r\n        }\r\n\r\n\r\n\r\n        //Get user posted photos\r\n        profileCtrl.postedPhotos = function (user_uuid) {\r\n            $http.post('/getPostedPhotos', {data: user_uuid})\r\n                .then(function (response) {\r\n                    profileCtrl.userPostedPhotos = response.data;\r\n                })\r\n        }\r\n\r\n\r\n        profileCtrl.getUserUpvote = function (user_uuid)\r\n        {\r\n            var ref = profileCtrl.topic.userUrl(user_uuid).child('upvote');\r\n            ref.on(\"value\",function(snapshot){\r\n                snapshot.forEach(function(data) {\r\n                    var key = 'user_upvoted_'+data.key();\r\n                    profileCtrl[key]  = true;\r\n                });\r\n            })\r\n        }\r\n\r\n        profileCtrl.getUserDwnvote = function (user_uuid)\r\n        {\r\n            var ref = profileCtrl.topic.userUrl(user_uuid).child('downvote');\r\n            ref.on(\"value\",function(snapshot){\r\n\r\n                snapshot.forEach(function(data) {\r\n                    var key = 'user_dwnvoted_'+data.key();\r\n                    profileCtrl[key]  = true;\r\n                });\r\n            })\r\n        }\r\n\r\n        //Getting user stat from firebase\r\n        profileCtrl.getUserStat = function(uuid)\r\n        {\r\n            var ref = new Firebase(\"https://qanya.firebaseio.com/user/\"+uuid+\"/stat/\");\r\n            ref.on(\"value\", function(snapshot) {\r\n                //need to replace '-' since NG doesn't allow us (weird)\r\n                uuid = uuid.replace(/-/g,\"\");\r\n                var key = 'user_stat_'+uuid;\r\n                profileCtrl[key]  = snapshot.val();\r\n            })\r\n        }\r\n\r\n\r\n        profileCtrl.profileImage = function(files)\r\n        {\r\n            angular.forEach(files, function(flowFile, i){\r\n                var fileReader = new FileReader();\r\n                fileReader.onload = function (event) {\r\n                    var uri = event.target.result;\r\n                    toastr.info('Saving...!');\r\n                    //profileCtrl.imageStrings[i] = uri;\r\n                    $.post( \"/api/previewImage/\", { data: uri} )\r\n                        .done(function( response ) {\r\n                            $http.post( \"/upload-profileImage\", { img: response} )\r\n                                .then(function( response ) {\r\n                                    $('#profilePhoto').attr( \"src\", response.data);\r\n                                    toastr.success('Save!');\r\n                                });\r\n                        });\r\n                };\r\n                fileReader.readAsDataURL(flowFile.file);\r\n            });\r\n        }\r\n\r\n        //List out notification\r\n        profileCtrl.listNotification = function()\r\n        {\r\n            $http.post('/list-notification')\r\n                .then(function(response){\r\n                    profileCtrl.notificationList = response.data;\r\n                });\r\n        }\r\n\r\n        //Acknowledge notification\r\n        profileCtrl.ackNotificataion = function()\r\n        {\r\n            $http.post('/ackNotification')\r\n                .then(function(response){\r\n                    profileCtrl.unreadNotification = response.data;\r\n                });\r\n        }\r\n\r\n        //Get the number of unread notificaiton\r\n        profileCtrl.userNotification = function()\r\n        {\r\n            $http.post('/getNotification')\r\n                .then(function(response){\r\n                    profileCtrl.unreadNotification = response.data;\r\n                });\r\n        }\r\n\r\n        profileCtrl.updateDescription = function()\r\n        {\r\n            $http.post('/user/update-description',\r\n                {name: $('#profileDescription').html()})\r\n                .then(function(response){\r\n                    toastr.success('Save!');\r\n                });\r\n        }\r\n\r\n        profileCtrl.getUserBookmark = function(user_uuid)\r\n        {\r\n            var ref = new Firebase(\"https://qanya.firebaseio.com/user/\"+user_uuid+\"/bookmark\");\r\n            ref.on(\"value\",function (snapshot) {\r\n\r\n                $http.post('/user/getBookmark',\r\n                    {data: snapshot.val()})\r\n                    .then(function(response){\r\n                        profileCtrl.userBookmark = response.data;\r\n                    })\r\n\r\n                //profileCtrl.userBookmark = snapshot.val();\r\n            });\r\n        }\r\n\r\n        profileCtrl.getUserHistory = function(user_uuid)\r\n        {\r\n            var ref = new Firebase(\"https://qanya.firebaseio.com/user/\"+user_uuid+\"/history\");\r\n            ref.orderByKey().on(\"value\",function (snapshot) {\r\n\r\n                console.log(snapshot.val());\r\n                $http.post('/user/getHistory',\r\n                    {data: snapshot.val()})\r\n                    .then(function(response){\r\n                        profileCtrl.userHistory = response.data;\r\n                    })\r\n            });\r\n        }\r\n\r\n        //Toggle sidebar\r\n        function buildToggler(navID) {\r\n            return function() {\r\n                $mdSidenav(navID)\r\n                    .toggle()\r\n                    .then(function () {\r\n                        $log.debug(\"toggle \" + navID + \" is done\");\r\n                    });\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n","angular.module('App')\r\n.directive('topicTally', function () {\r\n    return {\r\n        //controller: 'TopicCtrl as topicCtrl',\r\n        restrict: 'EA',\r\n        transclude:   true,\r\n        templateUrl: '/assets/templates/topic-tally.html',\r\n        scope: {\r\n            data: '='\r\n        }\r\n    }\r\n})\r\n\r\n.directive('profileBadge', function () {\r\n    return {\r\n        controller: 'ProfileCtrl as profileCtrl',\r\n        restrict: 'E',\r\n        transclude:   true,\r\n        scope: {\r\n            data: '='\r\n        },\r\n        templateUrl: '/assets/templates/profile-badge.html'\r\n    }\r\n})\r\n\r\n.directive('postedPhotos', function () {\r\n    return {\r\n        controller: 'ProfileCtrl as profileCtrl',\r\n        restrict: 'EA',\r\n        transclude:   true,\r\n        templateUrl: '/assets/templates/posted-photos.html',\r\n        scope: {\r\n            data: '='\r\n        }\r\n    }\r\n})\r\n\r\n\r\n//Preview images\r\n.directive('previewImages', function () {\r\n    return {\r\n        controller: 'PostCtrl as postCtrl',\r\n        restrict: 'E',\r\n        transclude: true,\r\n        scope: {\r\n            data: '='\r\n        },\r\n        templateUrl: '/assets/templates/preview-images.html'\r\n    }\r\n})\r\n\r\n.directive('reviewTopic', function () {\r\n    return {\r\n        controller: 'PostCtrl as postCtrl',\r\n        restrict: 'E',\r\n        transclude: true,\r\n        scope: {\r\n            data: '='\r\n        },\r\n        templateUrl: '/assets/templates/review-topic.html'\r\n    }\r\n})\r\n\r\n//Review score form\r\n.directive('reviewForm', function () {\r\n    return {\r\n        controller: 'PostCtrl as postCtrl',\r\n        restrict: 'E',\r\n        transclude: true,\r\n        scope: {\r\n            data: '='\r\n        },\r\n        templateUrl: '/assets/templates/review-form.html'\r\n    }\r\n})\r\n\r\n\r\n//Review score form\r\n.directive('minFeedList', function () {\r\n    return {\r\n        controller: 'PostCtrl as postCtrl',\r\n        restrict: 'E',\r\n        transclude: true,\r\n        scope: {\r\n            data: '='\r\n        },\r\n        templateUrl: '/assets/templates/min-feed-list.html'\r\n    }\r\n})\r\n\r\n//Review score form\r\n.directive('feedList', function () {\r\n    return {\r\n        controller: 'PostCtrl as postCtrl',\r\n        restrict: 'E',\r\n        transclude: true,\r\n        scope: {\r\n            data: '='\r\n        },\r\n        templateUrl: '/assets/templates/feed-list.html'\r\n    }\r\n})\r\n\r\n\r\n//User Tag list\r\n.directive('userTags', function () {\r\n    return {\r\n        controller: 'PostCtrl as postCtrl',\r\n        restrict: 'E',\r\n        transclude: true,\r\n        scope: {\r\n            data: '='\r\n        },\r\n        templateUrl: '/assets/templates/tag-list.html'\r\n    }\r\n})","angular.module('App')\r\n    .config(['$translateProvider', function ($translateProvider) {\r\n        $translateProvider.translations('Eng', {\r\n            'KEY_LOGIN_REGISTER':  'Login / Join us',\r\n            'KEY_NOTIFICATION':  'Notification',\r\n            'KEY_DASHBOARD':  'Dashboard',\r\n            'KEY_LANGUAGES':  'Languages',\r\n            'KEY_HOME':       'Home',\r\n            'KEY_REGISTER':   'Register',\r\n            'KEY_LOGIN':      'Log in',\r\n            'KEY_LOGOUT':     'Log out',\r\n            'KEY_FOLLOW':     'Follow',\r\n            'KEY_FOLLOWER':   'Follower',\r\n            'KEY_UNFOLLOW':   'Unfollow',\r\n            'KEY_FOLLOWING':  'Following',\r\n            'KEY_POST':       'Post',\r\n            'KEY_POSTED':     'Posted',\r\n            'KEY_UPVOTE':     'Upvote',\r\n            'KEY_UPVOTED':    'Upvoted',\r\n            'KEY_DWN_VOTE':   'Downvote',\r\n            'KEY_DWN_VOTED':  'Downvoted',\r\n            'KEY_VIEW':       'View',\r\n            'KEY_REMOVE':     'Remove',\r\n            'KEY_CANCEL':     'Cancel',\r\n            'KEY_QUESTION':   'Question',\r\n            'KEY_TOPIC':      'Topic',\r\n            'KEY_CHG_PWD':    'Change Password',\r\n            'KEY_PASSWORD':   'Password',\r\n            'KEY_OLD_PWD':    'Old Password',\r\n            'KEY_NEW_PWD':    'New Password',\r\n            'KEY_NEW_PWD_C':  'New password confirmation',\r\n            'KEY_SAVE':       'Save',\r\n            'KEY_SAVE_DRAFT': 'Save as draft',\r\n            'KEY_TAGS':       'Tags',\r\n            'KEY_EXPLORE':    'Explore',\r\n            'KEY_CHECK':      'Check',\r\n            'KEY_FEAT_CAT':   'Features categories',\r\n            'KEY_COMMENTS':   'Comments',\r\n            'KEY_REPLY':      'Reply',\r\n            'KEY_PHOTO':      'Photo',\r\n            'KEY_REVIEW':     'Review',\r\n            'KEY_EDIT':       'Edit',\r\n            'KEY_TREND':      'Trend',\r\n            'KEY_TRENDING':   'Trending',\r\n            'KEY_BOOKMARK':   'Bookmark',\r\n            'KEY_MST_REC':    'Most recomended',\r\n\r\n            'KEY_HISTORY':    'History',\r\n            'KEY_WRITE_REPLY':'Write a reply',\r\n            'KEY_LATEST_FEED':'Latest Feed',\r\n            'KEY_IN':         'in',\r\n            'KEY_BY':         'by',\r\n\r\n            //Remove topic\r\n            'KEY_CONF_REMOVE':'Are you sure you want to remove?',\r\n            'KEY_CONF_REM_C': 'Once remove, you will not be ableto to get this topic back',\r\n\r\n\r\n            //SENTENCE\r\n            'KEY_WHAT_ON_UR_MIND':  'What\\'s on your mind?',\r\n            'KEY_YOU_WANT_FOLLOW':  'You may want to follow',\r\n            'KEY_NO_ACCT_REGISTER': 'Don\\'t have account? Join us',\r\n            'KEY_CREATE_ACCT':      'Create account',\r\n            'KEY_CANT_CHNG_USER':   'Don\\'t have account? Register',\r\n            'KEY_YOUR_ACCOUNT':     'Your account',\r\n            'KEY_NOTHING_HERE':     'Nothing here, yet',\r\n            'KEY_WHO_TO_FOLLOW':    'Who to follow',\r\n            'KEY_CAT_WILL_APPEAR':  'Follow some categories and it will appear here',\r\n            'KEY_WHT_UR_STORY':     'What\\'s your story',\r\n            'KEY_WRT_COMMENT':      'Write a comment',\r\n            'KEY_FORGOT_PWD':       'Forgot Your Password?',\r\n            'KEY_UPLOAD_PHOTO':     'Upload photo',\r\n            'KEY_TAGS_FOLLOW':      'Tags you are following',\r\n            'KEY_NAME_CHG_ONCE':    'Warning! You can only change displayname once',\r\n            'KEY_SEL_CHN':          'Select channel',\r\n\r\n\r\n            //USER RATING\r\n            'KEY_USER_RATING':  'User Rating',\r\n            'KEY_DETAILS':      'Details',\r\n\r\n            //USER INPUT\r\n            'KEY_FIRSTNAME':  'First name',\r\n            'KEY_LASTNAME':   'Last name',\r\n            'KEY_BIRTHDAY':   'Birthday',\r\n            'KEY_MONTH':      'Month',\r\n            'KEY_DAY':        'Day',\r\n            'KEY_EMAIL':      'Email',\r\n            'KEY_CONF_EMAIL': 'Confirm Email',\r\n            'KEY_GENDER':     'Gender',\r\n            'KEY_MALE':       'Male',\r\n            'KEY_FEMALE':     'Female',\r\n            'KEY_USERNAME':   'Username',\r\n            'KEY_LOCATION':   'Location',\r\n            'KEY_REMEMBER_ME':'Remember me',\r\n\r\n            //User Edit\r\n            'KEY_ED_PROFILE': 'Edit Profile',\r\n            'KEY_ED_CHG_PWD': 'Change Password',\r\n            'KEY_ED_PROFILE': 'Edit Profile',\r\n            'KEY_ED_SITE':    'Website',\r\n            'KEY_ED_PHONE':   'Phone',\r\n            'KEY_ED_BIO':     'Biography',\r\n\r\n        });\r\n\r\n\r\n        //THAI TRANSLATIOn\r\n        $translateProvider.translations('', {\r\n            'KEY_LOGIN_REGISTER':  ' / ',\r\n            'KEY_NOTIFICATION':  'Notification',\r\n            'KEY_DASHBOARD':  '',\r\n            'KEY_LANGUAGES':  '',\r\n            'KEY_HOME':       '',\r\n            'KEY_REGISTER':   '',\r\n            'KEY_LOGIN':      '',\r\n            'KEY_LOGOUT':     '',\r\n            'KEY_FOLLOW':     '',\r\n            'KEY_FOLLOWER':   '',\r\n            'KEY_UNFOLLOW':   '',\r\n            'KEY_FOLLOWING':  '',\r\n            'KEY_POST':       '',\r\n            'KEY_POSTED':     '',\r\n            'KEY_UPVOTE':     '',\r\n            'KEY_UPVOTED':    '',\r\n            'KEY_DWN_VOTE':   '',\r\n            'KEY_DWN_VOTED':  '',\r\n            'KEY_VIEW':       '',\r\n            'KEY_REMOVE':     '',\r\n            'KEY_CANCEL':     '',\r\n            'KEY_QUESTION':   '',\r\n            'KEY_TOPIC':      '',\r\n            'KEY_CHG_PWD':    '',\r\n            'KEY_PASSWORD':   '',\r\n            'KEY_OLD_PWD':    '',\r\n            'KEY_NEW_PWD':    '',\r\n            'KEY_NEW_PWD_C':  '',\r\n            'KEY_SAVE':       '',\r\n            'KEY_SAVE_DRAFT': '',\r\n            'KEY_TAGS':       '',\r\n            'KEY_EXPLORE':    'Explore',\r\n            'KEY_CHECK':      '',\r\n            'KEY_FEAT_CAT':   'Features categories',\r\n            'KEY_COMMENTS':   '',\r\n            'KEY_REPLY':      '',\r\n            'KEY_PHOTO':      '',\r\n            'KEY_REVIEW':     '',\r\n            'KEY_EDIT':       '',\r\n            'KEY_TREND':      '',\r\n            'KEY_TRENDING':   '',\r\n            'KEY_BOOKMARK':   '',\r\n            'KEY_MST_REC':    '',\r\n\r\n            'KEY_HISTORY':    '',\r\n            'KEY_WRITE_REPLY':'',\r\n            'KEY_LATEST_FEED':'',\r\n            'KEY_IN':         '',\r\n            'KEY_BY':         '',\r\n\r\n            //Remove topic\r\n            'KEY_CONF_REMOVE':'?',\r\n            'KEY_CONF_REM_C': '',\r\n\r\n            //SENTENCE\r\n            'KEY_WHAT_ON_UR_MIND':  '?',\r\n            'KEY_YOU_WANT_FOLLOW':  '',\r\n            'KEY_NO_ACCT_REGISTER': '? ',\r\n            'KEY_CREATE_ACCT':      '',\r\n            'KEY_CANT_CHNG_USER':   '? ',\r\n            'KEY_YOUR_ACCOUNT':     '',\r\n            'KEY_NOTHING_HERE':     '',\r\n            'KEY_WHO_TO_FOLLOW':    '',\r\n            'KEY_CAT_WILL_APPEAR':  'Follow some categories and it will appear here',\r\n            'KEY_WHT_UR_STORY':     'What\\'s your story',\r\n            'KEY_WRT_COMMENT':      '',\r\n            'KEY_FORGOT_PWD':       '?',\r\n            'KEY_UPLOAD_PHOTO':     '',\r\n            'KEY_TAGS_FOLLOW':      '',\r\n            'KEY_NAME_CHG_ONCE':    '! ',\r\n            'KEY_SEL_CHN':          '',\r\n\r\n            //USER RATING\r\n            'KEY_USER_RATING':  '',\r\n            'KEY_DETAILS':      '',\r\n\r\n            //USER INPUT\r\n            'KEY_FIRSTNAME':  '',\r\n            'KEY_LASTNAME':   '',\r\n            'KEY_BIRTHDAY':   'Birthday',\r\n            'KEY_MONTH':      'Month',\r\n            'KEY_DAY':        'Day',\r\n            'KEY_EMAIL':      '',\r\n            'KEY_CONF_EMAIL': '',\r\n            'KEY_GENDER':     '',\r\n            'KEY_MALE':       '',\r\n            'KEY_FEMALE':     '',\r\n            'KEY_USERNAME':   '',\r\n            'KEY_LOCATION':   '',\r\n            'KEY_REMEMBER_ME':'',\r\n\r\n            //User Edit\r\n            'KEY_ED_PROFILE': '',\r\n            'KEY_ED_CHG_PWD': '',\r\n            'KEY_ED_SITE':    '',\r\n            'KEY_ED_PHONE':   '',\r\n            'KEY_ED_BIO':     '',\r\n\r\n        });\r\n\r\n        $translateProvider.preferredLanguage('Eng');\r\n    }])"],"sourceRoot":"/source/"}