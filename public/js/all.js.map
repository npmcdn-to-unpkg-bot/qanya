{"version":3,"sources":["home.js","ngApps.js","postController.js","posts.service.js","profileController.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"all.js","sourcesContent":["function getFeedCate(slug){\r\n    $.get( \"/getFeed/\", { slug: slug } )\r\n        .done(function( data ) {\r\n            $('#homeFeed').html(data);\r\n        });\r\n}\r\n\r\nfunction ipLogger()\r\n{\r\n    $.getJSON('http://ipinfo.io', function(data){\r\n        return data;\r\n    })\r\n}","//Angular config and modules\r\n\r\nvar app = angular.module('App', ['ngMaterial','flow','angularMoment','firebase'])\r\n\r\n.constant('FirebaseUrl', 'https://qanya.firebaseio.com/')\r\n.config([\"$mdThemingProvider\", function ($mdThemingProvider) {\r\n    $mdThemingProvider.definePalette('slack', {\r\n        '50': 'ffebee',\r\n        '100': 'ffcdd2',\r\n        '200': 'ef9a9a',\r\n        '300': 'e57373',\r\n        '400': 'ef5350',\r\n        '500': '4D394B', // primary colour\r\n        '600': 'e53935',\r\n        '700': 'd32f2f',\r\n        '800': 'c62828',\r\n        '900': 'b71c1c',\r\n        'A100': 'ff8a80',\r\n        'A200': 'ff5252',\r\n        'A400': 'ff1744',\r\n        'A700': 'd50000',\r\n        'contrastDefaultColor': 'light', // whether, by default, text (contrast)\r\n        // on this palette should be dark or light\r\n        'contrastDarkColors': ['50', '100', // hues which contrast should be 'dark' by default\r\n            '200', '300', '400', 'A100'],\r\n        'contrastLightColors': undefined // could also specify this if default was 'dark'\r\n    })\r\n    $mdThemingProvider.theme('default')\r\n        .primaryPalette('slack')\r\n}])","angular.module('App')\r\n    .controller('PostCtrl',function($http,$mdDialog,$firebaseObject,$firebaseArray,Topics){\r\n\r\n        var postCtrl = this;\r\n\r\n\r\n        postCtrl.topics = Topics;\r\n\r\n        postCtrl.displayname ={\r\n            'text' :'',\r\n            'saveBtn':  false,\r\n            'alert':    false\r\n        }\r\n\r\n        postCtrl.topicTags      = [];\r\n        postCtrl.postFeedFollow = 'Follow';\r\n        postCtrl.postFollow     = 'Follow';\r\n        postCtrl.topicReply     = '';\r\n\r\n\r\n\r\n        postCtrl.showLogin = function(ev) {\r\n        var useFullScreen = ($mdMedia('sm') || $mdMedia('xs'))  && $scope.customFullscreen;\r\n            $mdDialog.show({              \r\n              templateUrl: 'dialog1.tmpl.html',\r\n              parent: angular.element(document.body),\r\n              targetEvent: ev,\r\n              clickOutsideToClose:true,\r\n              fullscreen: useFullScreen\r\n            })\r\n        }\r\n\r\n\r\n        postCtrl.feedFollowStatus = function(slug)\r\n        {\r\n            $http.post('/feedFollowStatus/', {data: slug})\r\n                .then(function(response){\r\n                    console.log(response);\r\n                    if(response.data == 0)\r\n                    {\r\n                        postCtrl.postFeedFollow = 'follow';\r\n                    }else{\r\n                        postCtrl.postFeedFollow = 'following';\r\n                    }\r\n                });\r\n        }\r\n\r\n\r\n        //Follow categories\r\n        postCtrl.followCate = function(slug){\r\n\r\n            $http.post('/follow-cate/', {data: slug})\r\n                .then(function(response){\r\n                    console.log(response)\r\n                    if(response.data== 0)\r\n                    {\r\n                        postCtrl.postFeedFollow ='follow';\r\n                    }\r\n                    else\r\n                    {\r\n                        postCtrl.postFeedFollow ='following';\r\n                    }\r\n                });\r\n        }\r\n\r\n\r\n        //Follower user\r\n        //@Params uuid - author ID\r\n        postCtrl.followUser = function(uuid)\r\n        {\r\n            $http.post('/followUser/', { data: uuid})\r\n                .then(function(response){\r\n                    if(response.data == 0)\r\n                    {\r\n                        postCtrl.postFollow = 'follow';\r\n                    }else{\r\n\r\n                        postCtrl.postFollow = 'following';\r\n                    }\r\n                });\r\n        }\r\n\r\n\r\n        //Is currently following user\r\n        //@Params uuid - author ID\r\n        postCtrl.isFollow = function(uuid)\r\n        {\r\n            $http.post('/userFollowStatus/', { data: uuid})\r\n                .then(function(response){\r\n                    if(response.data == 0)\r\n                    {\r\n                        postCtrl.postFollow = 'follow';\r\n                    }else{\r\n                        postCtrl.postFollow = 'following';\r\n                    }\r\n                });\r\n        }\r\n\r\n\r\n        postCtrl.getFeedCate = function(slug,catename){\r\n            postCtrl.slug = slug;\r\n            postCtrl.feedName =  catename;\r\n            $http.post('/getFeed/', {slug: slug})\r\n                .then(function(response){\r\n                    $('#homeFeed').html(response.data);\r\n                });\r\n        }\r\n\r\n\r\n        postCtrl.checkDisplayname = function(){\r\n\r\n            $http.post('/check-name', {name: postCtrl.displayname.text})\r\n                .then(function(response){\r\n                if(response.data == \"0\"){\r\n                    postCtrl.displayname.saveBtn = true;\r\n                    postCtrl.displayname.alert   = false;\r\n                }else{\r\n                    postCtrl.displayname.saveBtn = false;\r\n                    postCtrl.displayname.alert   = true;\r\n                }\r\n            });\r\n        }\r\n\r\n\r\n        //Reply in the post\r\n        postCtrl.postReply = function(uuid,topics_uid,sender)\r\n        {\r\n            var replyObj = 'reply_append_'+uuid;\r\n            $http.post('/replyTopic', {uuid: uuid,\r\n                                       topics_uid: topics_uid,\r\n                                       data: $('#topicReplyContainer').html() })\r\n                .then(function(response){\r\n                    $http.get(\"http://ipinfo.io\")\r\n                        .then(function(response){\r\n                        var geo_data = response\r\n                        $http.post('/ip-logger', {  uuid: uuid,\r\n                            topics_uid: topics_uid,\r\n                            action: 'reply',\r\n                            geoResponse: geo_data\r\n                        })\r\n                    })\r\n                    var commentCounter = postCtrl.topics.ref.child('topic/'+uuid+'/comments')\r\n                    commentCounter.transaction(function (current_value) {\r\n                        return (current_value || 0) + 1;\r\n                    })\r\n                })\r\n        }\r\n\r\n\r\n        //Post topic\r\n        postCtrl.postTopic = function()\r\n        {\r\n            var imgIds = new Array();\r\n\r\n            $(\"div#contentBody img\").each(function(){\r\n                imgIds.push($(this).attr('src'));\r\n            });\r\n\r\n            var data = { title:         postCtrl.title,\r\n                         categories:    postCtrl.categories,\r\n                         tags:          postCtrl.topicTags,\r\n                         body:          $('#contentBody').html(),\r\n                         images:        imgIds\r\n                        };\r\n            $.post( \"/api/postTopic/\", { data: data} )\r\n                .done(function( response ) {\r\n                    $http.get(\"http://ipinfo.io\")\r\n                        .then(function(response){\r\n                            var geo_data = response\r\n                            $http.post('/ip-logger', {  uuid: uuid,\r\n                                topics_uid: topics_uid,\r\n                                action: 'topic',\r\n                                geoResponse: geo_data\r\n                            })\r\n                        })\r\n                    url = '/'+response.author+'/'+response.slug;\r\n                    window.location = url;\r\n                })\r\n\r\n        }\r\n\r\n        //Preview images\r\n        postCtrl.imageStrings = [];\r\n        postCtrl.processFiles = function(files){\r\n            angular.forEach(files, function(flowFile, i){\r\n                console.log(flowFile);\r\n                var fileReader = new FileReader();\r\n                fileReader.onload = function (event) {\r\n                    var uri = event.target.result;\r\n                    postCtrl.imageStrings[i] = uri;\r\n                    $.post( \"/api/previewImage/\", { data: uri} )\r\n                        .done(function( response ) {\r\n                            $('#contentBody').append('<img src=\\\"'+response+'\\\" class=\\\"img-fluid\\\">');\r\n                        })\r\n                };\r\n                fileReader.readAsDataURL(flowFile.file);\r\n            });\r\n        };\r\n\r\n\r\n        postCtrl.incrementView = function(topic_uuid)\r\n        {\r\n            var ref = new Firebase(\"https://qanya.firebaseio.com/topic/\"+topic_uuid+'/view');\r\n            return ref.on(\"value\", function(snapshot) {\r\n                console.log(\"view: \"+snapshot.val());\r\n                if(snapshot.val() ==0)\r\n                {\r\n                    ref.set(1);\r\n                }else\r\n                {\r\n                    ref.set(snapshot.val()+1)\r\n                }\r\n                return snapshot.val();\r\n            });\r\n        }\r\n\r\n        postCtrl.upvoteTally    =   function(topic_uuid)\r\n        {\r\n            var ref = postCtrl.topics.ref.child('topic/'+topic_uuid+'/upvote')\r\n            ref.on(\"value\", function (snapshot) {\r\n                var key = 'upvote_'+topic_uuid;\r\n                postCtrl[key]  = snapshot.val();\r\n            });\r\n        }\r\n\r\n        postCtrl.dwnvoteTally    =   function(topic_uuid)\r\n        {\r\n            var ref = postCtrl.topics.ref.child('topic/'+topic_uuid+'/downvote')\r\n            ref.on(\"value\", function(snapshot) {\r\n                var the_string = 'dwnvote_'+topic_uuid;\r\n                postCtrl[the_string]  = snapshot.val();\r\n            });\r\n        }\r\n\r\n        postCtrl.dwnvote =function(topic_uuid,topic_uid)\r\n        {\r\n            postCtrl.upvoteReset(topic_uuid,topic_uid);\r\n            var btn = \"#dwnvote_btn_status_\"+topic_uuid;\r\n\r\n            //UserDownvote Value\r\n            var userUpvoteRef = postCtrl.topics.upvoteURL(topic_uid).child('downvote/'+topic_uuid);\r\n            userUpvoteRef.once(\"value\", function(snapshot) {\r\n\r\n                //Chck if user already voted\r\n                if (snapshot.exists() == false) {\r\n\r\n                    postCtrl.topics.upvoteURL(topic_uid).child('downvote/'+topic_uuid).set(moment().format());\r\n\r\n                    //Topic Upvote tally\r\n                    var topicRef = postCtrl.topics.ref.child('topic/'+topic_uuid+'/downvote')\r\n                    topicRef.transaction(function (current_value) {\r\n                        return (current_value || 0) + 1;\r\n                    });\r\n                }else{ //value already exist\r\n                    postCtrl.dwnvoteReset(topic_uuid,topic_uid);\r\n                }\r\n            })\r\n        }\r\n\r\n\r\n        //Reset upvote to zero\r\n        postCtrl.upvoteReset =function(topic_uuid,topic_uid)\r\n        {\r\n            var btn = \"#upvote_btn_status_\"+topic_uuid;\r\n            //Remove voted user\r\n            postCtrl.topics.upvoteURL(topic_uid).child('upvote/'+topic_uuid).remove();\r\n\r\n            //Decrement the tally\r\n            var topicRef = postCtrl.topics.ref.child('topic/'+topic_uuid+'/upvote')\r\n            topicRef.transaction(function (current_value) {\r\n                if(current_value < 0 || current_value == 0 )\r\n                {\r\n                    return 0;\r\n                }else{\r\n                    return current_value - 1;\r\n                }\r\n            });\r\n            \r\n        }\r\n\r\n        //Reset downvote to zero\r\n        postCtrl.dwnvoteReset =function(topic_uuid,topic_uid)\r\n        {\r\n            var btn = \"#dwnvote_btn_status_\"+topic_uuid;\r\n            //Remove voted user\r\n            postCtrl.topics.upvoteURL(topic_uid).child('downvote/'+topic_uuid).remove();\r\n\r\n            //Decrement the tally\r\n            var topicRef = postCtrl.topics.ref.child('topic/'+topic_uuid+'/downvote')\r\n            topicRef.transaction(function (current_value) {\r\n                if(current_value < 0 || current_value == 0 )\r\n                {\r\n                    return 0;\r\n                }else{\r\n                    return current_value - 1;\r\n                }\r\n            });\r\n        }\r\n\r\n\r\n        postCtrl.upvote =function(topic_uuid,topic_uid)\r\n        {\r\n            postCtrl.dwnvoteReset(topic_uuid,topic_uid);\r\n            var btn = \"#upvote_btn_status_\"+topic_uuid;\r\n            //UserUpvote Value\r\n            var userUpvoteRef = postCtrl.topics.upvoteURL(topic_uid).child('upvote/'+topic_uuid);\r\n            userUpvoteRef.once(\"value\", function(snapshot) {\r\n\r\n                //Chck if user already voted\r\n                if (snapshot.exists() == false) {\r\n\r\n                    postCtrl.topics.upvoteURL(topic_uid).child('upvote/'+topic_uuid).set(moment().format());\r\n\r\n                    //Topic Upvote tally\r\n                    var topicRef = postCtrl.topics.ref.child('topic/'+topic_uuid+'/upvote')\r\n                    topicRef.transaction(function (current_value) {\r\n                        return (current_value || 0) + 1;\r\n                    });\r\n                }else{ //value already exist\r\n                    postCtrl.upvoteReset(topic_uuid,topic_uid);\r\n                }\r\n            })\r\n\r\n            /*$http.post('/upvote/', {    topics_uuid:    topic_uuid,\r\n                                        topic_uid:      topic_uid\r\n                                    })\r\n            .then(function(response){\r\n                console.log(response.data);\r\n                var btn = \"#upvote_btn_status_\"+topic_uuid;\r\n                if(response.data ==1) {\r\n                    $(btn).addClass(\"label label-pill label-success\");\r\n                }else{\r\n                    $(btn).removeClass(\"label label-pill label-success\");\r\n                }\r\n            });*/\r\n        }\r\n    })","angular.module('App')\r\n    // Topic list\r\n    .factory('Topics', function ($firebaseObject, $firebaseArray, FirebaseUrl) {\r\n        var ref = new Firebase(FirebaseUrl)\r\n        var topics = $firebaseObject(ref)\r\n        var topicsArr = $firebaseArray(ref)\r\n        var topicKey = '';\r\n\r\n        var Topics = {\r\n\r\n            // Reply listing\r\n            upvoteURL: function (user_uuid){\r\n                return ref.child('user/'+user_uuid)\r\n            },\r\n            replyList: function (topic_uuid) {\r\n                var data = ref.child(topic_uuid + '/replies');\r\n                console.log(data);\r\n                return $firebaseArray(data)\r\n            },\r\n            ref: ref\r\n        }\r\n        return Topics;\r\n\r\n    })\r\n","angular.module('App')\r\n    .controller('ProfileCtrl',function($http,$mdToast,$timeout, $mdSidenav, $log){\r\n\r\n        var profileCtrl = this;\r\n\r\n        profileCtrl.profileDescription  =   '';\r\n        profileCtrl.notificationList    =   '';\r\n        profileCtrl.unreadNotification  =   0;\r\n\r\n\r\n        profileCtrl.toggleRight = buildToggler('alertSideNav');\r\n        profileCtrl.isOpenRight = function(){\r\n            return $mdSidenav('alertSideNav').isOpen();\r\n        };\r\n\r\n\r\n        var last = {\r\n            bottom: false,\r\n            top: true,\r\n            left: false,\r\n            right: true\r\n        };\r\n\r\n        profileCtrl.toastPosition = angular.extend({},last);\r\n        profileCtrl.getToastPosition = function() {\r\n            sanitizePosition();\r\n            return Object.keys(profileCtrl.toastPosition)\r\n                .filter(function(pos) { return profileCtrl.toastPosition[pos]; })\r\n                .join(' ');\r\n        };\r\n        function sanitizePosition() {\r\n            var current = profileCtrl.toastPosition;\r\n            if ( current.bottom && last.top ) current.top = false;\r\n            if ( current.top && last.bottom ) current.bottom = false;\r\n            if ( current.right && last.left ) current.left = false;\r\n            if ( current.left && last.right ) current.right = false;\r\n            last = angular.extend({},current);\r\n        }\r\n\r\n        profileCtrl.profileImage = function(files)\r\n        {\r\n            angular.forEach(files, function(flowFile, i){\r\n                console.log(flowFile);\r\n                var fileReader = new FileReader();\r\n                fileReader.onload = function (event) {\r\n                    var uri = event.target.result;\r\n                    //profileCtrl.imageStrings[i] = uri;\r\n                    $.post( \"/api/previewImage/\", { data: uri} )\r\n                        .done(function( response ) {\r\n                            $http.post( \"/upload-profileImage\", { img: response} )\r\n                                .then(function( response ) {\r\n                                    $('#profilePhoto').attr( \"src\", response.data);\r\n                                    $mdToast.show(\r\n                                        $mdToast.simple()\r\n                                            .textContent('Save')\r\n                                            .position(profileCtrl.getToastPosition())\r\n                                            .hideDelay(3000)\r\n                                    );\r\n                                });\r\n                        });\r\n                };\r\n                fileReader.readAsDataURL(flowFile.file);\r\n            });\r\n        }\r\n\r\n        //List out notification\r\n        profileCtrl.listNotification = function()\r\n        {\r\n            $http.post('/list-notification')\r\n                .then(function(response){\r\n                    console.log(response);\r\n                    profileCtrl.notificationList = response.data;\r\n                });\r\n        }\r\n\r\n        //Acknowledge notification\r\n        profileCtrl.ackNotificataion = function()\r\n        {\r\n            $http.post('/ackNotification')\r\n                .then(function(response){\r\n                    profileCtrl.unreadNotification = response.data;\r\n                });\r\n        }\r\n\r\n        //Get the number of unread notificaiton\r\n        profileCtrl.userNotification = function()\r\n        {\r\n            $http.post('/getNotification')\r\n                .then(function(response){\r\n                    profileCtrl.unreadNotification = response.data;\r\n                });\r\n        }\r\n\r\n        profileCtrl.updateDescription = function()\r\n        {\r\n            $http.post('/user/update-description',\r\n                {name: $('#profileDescription').html()})\r\n                .then(function(response){\r\n\r\n                    $mdToast.show(\r\n                        $mdToast.simple()\r\n                            .textContent('Save!')\r\n                            .position('top right')\r\n                            .hideDelay(3000)\r\n                    );\r\n                });\r\n        }\r\n\r\n        //Toggle sidebar\r\n        function buildToggler(navID) {\r\n            return function() {\r\n                $mdSidenav(navID)\r\n                    .toggle()\r\n                    .then(function () {\r\n                        $log.debug(\"toggle \" + navID + \" is done\");\r\n                    });\r\n            }\r\n        }\r\n    });\r\n\r\n\r\n"],"sourceRoot":"/source/"}